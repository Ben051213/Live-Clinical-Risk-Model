<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Clinical Risk Model (Python-Trained)</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 
      This is the main JavaScript 'brain' of your application.
      We put it in the <head> to ensure the function is defined
      BEFORE the <body> of the page tries to use it.
    -->
    <script>
        function riskCalculator() {
            return {
                // 1. Input Data
                vitals: {
                    o2_sat: 98,
                    resp_rate: 16,
                    systolic_bp: 120,
                    heart_rate: 70,
                    temp: 36.6,
                    o2_scale: 1, 
                    on_oxygen: 0, 
                    consciousness: 0, // 'A' (Alert) is 0
                },
                
                // 2. Output Data
                result: {
                    level: 'Normal',
                    advice: 'Prediction updates as you change values.'
                },
                
                // 3. The "Model" Logic (Transpiled from Python)
                calculateRisk() {
                    
                    // --- THIS IS THE REAL, PYTHON-TRAINED DECISION TREE ---
                    // It has been translated from sklearn's 'export_text' output
                    // into JavaScript if/else logic.
                    
                    const v = this.vitals;
                    let prediction = 'Normal'; // Default prediction

                    if (v.o2_sat <= 91.5) {
                        if (v.resp_rate <= 24.5) {
                            if (v.heart_rate <= 110.5) {
                                prediction = 'Medium';
                            } else { // v.heart_rate > 110.5
                                prediction = 'High';
                            }
                        } else { // v.resp_rate > 24.5
                            if (v.systolic_bp <= 85.0) {
                                prediction = 'High';
                            } else { // v.systolic_bp > 85.0
                                if (v.temp <= 39.5) {
                                    prediction = 'High';
                                } else { // v.temp > 39.5
                                    prediction = 'High';
                                }
                            }
                        }
                    } else { // v.o2_sat > 91.5
                        if (v.resp_rate <= 11.5) {
                            prediction = 'Normal'; 
                        } else { // v.resp_rate > 11.5
                            if (v.systolic_bp <= 101.5) {
                                if (v.consciousness <= 0.5) { // consciousness == 0 ('A')
                                    if (v.heart_rate <= 104.5) {
                                        prediction = 'Medium';
                                    } else { // v.heart_rate > 104.5
                                        prediction = 'High';
                                    }
                                } else { // consciousness > 0.5 ('P', 'U', 'V')
                                    prediction = 'High';
                                }
                            } else { // v.systolic_bp > 101.5
                                if (v.resp_rate <= 20.5) {
                                    if (v.temp <= 37.7) {
                                        prediction = 'Low';
                                    } else { // v.temp > 37.7
                                        prediction = 'Medium';
                                    }
                                } else { // v.resp_rate > 20.5
                                    if (v.temp <= 38.3) {
                                        prediction = 'Low';
                                    } else { // v.temp > 38.3
                                        prediction = 'Medium';
                                    }
                                }
                            }
                        }
                    }
                    // --- END OF PYTHON MODEL LOGIC ---

                    // --- Update Result ---
                    this.result.level = prediction;
                    
                    if (prediction === 'High') {
                        this.result.advice = 'Urgent clinical intervention required.';
                    } else if (prediction === 'Medium') {
                        this.result.advice = 'Requires frequent monitoring and assessment.';
                    } else if (prediction === 'Low') {
                        this.result.advice = 'Patient stable. Continue routine monitoring.';
                    } else { // Normal
                        this.result.advice = 'Patient is stable. No immediate risk detected.';
                    }
                },
                
                // Initialize the calculator on load
                init() {
                    this.calculateRisk();
                }
            }
        }
    </script>
    
    <!-- 2. Load Alpine.js for interactivity -->
    <script src="//unpkg.com/alpinejs" defer></script>
    
    <style>
        /* Use Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for sliders */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        
        input[type=range]:focus {
            outline: none;
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #374151; /* gray-700 */
            border-radius: 5px;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #3b82f6; /* blue-500 */
            cursor: pointer;
            margin-top: -8px; /* Center thumb on track */
            border: 4px solid #fff; /* white */
        }

        /* Firefox */
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #374151;
            border-radius: 5px;
        }
        
        input[type=range]::-moz-range-thumb {
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 4px solid #fff;
        }
        
        /* Hide number input arrows in Chrome/Safari/Edge */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        /* Hide number input arrows in Firefox */
        input[type=number] {
          -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center p-4">

    <div 
        x-data="riskCalculator()"
        x-init="init()"
        class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-8 grid grid-cols-1 md:grid-cols-2 gap-8"
    >
        
        <!-- Left Side: Inputs -->
        <div>
            <h1 class="text-3xl font-bold text-white mb-2">Live Clinical Risk Model</h1>
            <p class="text-gray-400 mb-6">This interactive tool runs a <span class="font-bold text-blue-400">real Decision Tree model</span> trained in Python on 1,000 patient records.</p>
            
            <div class="space-y-6">
                
                <!-- 1. Oxygen Saturation -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label for="o2_sat_slider" class="font-medium text-gray-300">Oxygen Saturation (SpO₂)</label>
                        <!-- NEW: Input box + unit -->
                        <div class="flex items-center space-x-2">
                            <input 
                                type="number" 
                                min="80" 
                                max="100" 
                                x-model.number="vitals.o2_sat" 
                                @input="calculateRisk()"
                                class="w-20 bg-gray-700 text-white font-bold text-lg rounded-lg border border-gray-600 p-1 text-center"
                            >
                            <span class="text-lg text-gray-400">%</span>
                        </div>
                    </div>
                    <input 
                        id="o2_sat_slider" 
                        type="range" 
                        min="80" 
                        max="100" 
                        x-model.number="vitals.o2_sat" 
                        @input="calculateRisk()" 
                        class="w-full"
                    >
                </div>
                
                <!-- 2. Respiratory Rate -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label for="resp_rate_slider" class="font-medium text-gray-300">Respiratory Rate</label>
                        <!-- NEW: Input box + unit -->
                        <div class="flex items-center space-x-2">
                            <input 
                                type="number" 
                                min="5" 
                                max="40" 
                                x-model.number="vitals.resp_rate" 
                                @input="calculateRisk()"
                                class="w-20 bg-gray-700 text-white font-bold text-lg rounded-lg border border-gray-600 p-1 text-center"
                            >
                            <span class="text-lg text-gray-400">/min</span>
                        </div>
                    </div>
                    <input 
                        id="resp_rate_slider" 
                        type="range" 
                        min="5" 
                        max="40" 
                        x-model.number="vitals.resp_rate" 
                        @input="calculateRisk()" 
                        class="w-full"
                    >
                </div>

                <!-- 3. Systolic Blood Pressure -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label for="systolic_bp_slider" class="font-medium text-gray-300">Systolic BP</label>
                        <!-- NEW: Input box + unit -->
                        <div class="flex items-center space-x-2">
                            <input 
                                type="number" 
                                min="50" 
                                max="180" 
                                x-model.number="vitals.systolic_bp" 
                                @input="calculateRisk()"
                                class="w-20 bg-gray-700 text-white font-bold text-lg rounded-lg border border-gray-600 p-1 text-center"
                            >
                            <span class="text-lg text-gray-400">mmHg</span>
                        </div>
                    </div>
                    <input 
                        id="systolic_bp_slider" 
                        type="range" 
                        min="50" 
                        max="180" 
                        x-model.number="vitals.systolic_bp" 
                        @input="calculateRisk()" 
                        class="w-full"
                    >
                </div>

                <!-- 4. Heart Rate -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label for="heart_rate_slider" class="font-medium text-gray-300">Heart Rate</label>
                        <!-- NEW: Input box + unit -->
                        <div class="flex items-center space-x-2">
                            <input 
                                type="number" 
                                min="40" 
                                max="180" 
                                x-model.number="vitals.heart_rate" 
                                @input="calculateRisk()"
                                class="w-20 bg-gray-700 text-white font-bold text-lg rounded-lg border border-gray-600 p-1 text-center"
                            >
                            <span class="text-lg text-gray-400">bpm</span>
                        </div>
                    </div>
                    <input 
                        id="heart_rate_slider" 
                        type="range" 
                        min="40" 
                        max="180" 
                        x-model.number="vitals.heart_rate" 
                        @input="calculateRisk()" 
                        class="w-full"
                    >
                </div>

                <!-- 5. Temperature -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label for="temp_slider" class="font-medium text-gray-300">Temperature</label>
                        <!-- NEW: Input box + unit -->
                        <div class="flex items-center space-x-2">
                            <input 
                                type="number" 
                                min="35.0" 
                                max="41.5" 
                                step="0.1" 
                                x-model.number="vitals.temp" 
                                @input="calculateRisk()"
                                class="w-20 bg-gray-700 text-white font-bold text-lg rounded-lg border border-gray-600 p-1 text-center"
                            >
                            <span class="text-lg text-gray-400">°C</span>
                        </div>
                    </div>
                    <input 
                        id="temp_slider" 
                        type="range" 
                        min="35.0" 
                        max="41.5" 
                        step="0.1" 
                        x-model.number="vitals.temp" 
                        @input="calculateRisk()" 
                        class="w-full"
                    >
                </div>
                
                <!-- 6. Consciousness -->
                <div @change="calculateRisk()">
                    <label class="font-medium text-gray-300 block mb-2">Consciousness</label>
                    <div class="grid grid-cols-4 gap-2">
                        <label :class="{ 'bg-blue-600 border-blue-500 text-white': vitals.consciousness === 0, 'bg-gray-700 border-gray-600 hover:bg-gray-600': vitals.consciousness !== 0 }" class="block text-center p-3 rounded-lg border-2 cursor-pointer transition-all">
                            <input type="radio" name="consciousness" x-model.number="vitals.consciousness" value="0" class="sr-only"><span class="font-medium">Alert (A)</span>
                        </label>
                        <label :class="{ 'bg-blue-600 border-blue-500 text-white': vitals.consciousness === 1, 'bg-gray-700 border-gray-600 hover:bg-gray-600': vitals.consciousness !== 1 }" class="block text-center p-3 rounded-lg border-2 cursor-pointer transition-all">
                            <input type="radio" name="consciousness" x-model.number="vitals.consciousness" value="1" class="sr-only"><span class="font-medium">Pain (P)</span>
                        </label>
                        <label :class="{ 'bg-blue-600 border-blue-500 text-white': vitals.consciousness === 2, 'bg-gray-700 border-gray-600 hover:bg-gray-600': vitals.consciousness !== 2 }" class="block text-center p-3 rounded-lg border-2 cursor-pointer transition-all">
                            <input type="radio" name="consciousness" x-model.number="vitals.consciousness" value="2" class="sr-only"><span class="font-medium">Unresp (U)</span>
                        </label>
                        <label :class="{ 'bg-blue-600 border-blue-500 text-white': vitals.consciousness === 3, 'bg-gray-700 border-gray-600 hover:bg-gray-600': vitals.consciousness !== 3 }" class="block text-center p-3 rounded-lg border-2 cursor-pointer transition-all">
                            <input type="radio" name="consciousness" x-model.number="vitals.consciousness" value="3" class="sr-only"><span class="font-medium">Voice (V)</span>
                        </label>
                    </div>
                </div>

            </div>
        </div>
        
        <!-- Right Side: Output -->
        <div class="bg-gray-900 rounded-2xl flex flex-col items-center justify-center p-8 border-4"
             :class="{
                'border-green-500': result.level === 'Normal',
                'border-blue-500': result.level === 'Low',
                'border-yellow-500': result.level === 'Medium',
                'border-red-500': result.level === 'High'
             }"
        >
            <h2 class="text-xl font-semibold text-gray-400 mb-4">Patient Risk Profile</h2>
            
            <div class="relative w-48 h-48 flex items-center justify-center">
                <!-- Animated Ring -->
                <div class="absolute w-full h-full rounded-full"
                    :class="{
                        'bg-green-500/10': result.level === 'Normal',
                        'bg-blue-500/10': result.level === 'Low',
                        'bg-yellow-500/10': result.level === 'Medium',
                        'bg-red-500/10': result.level === 'High'
                    }"></div>
                <div class="absolute w-3/4 h-3/4 rounded-full"
                    :class="{
                        'bg-green-500/20': result.level === 'Normal',
                        'bg-blue-500/20': result.level === 'Low',
                        'bg-yellow-500/20': result.level === 'Medium',
                        'bg-red-500/20': result.level === 'High'
                    }"></div>

                <!-- Risk Level Text -->
                <span class="absolute text-5xl font-extrabold"
                      :class="{
                        'text-green-400': result.level === 'Normal',
                        'text-blue-400': result.level === 'Low',
                        'text-yellow-400': result.level === 'Medium',
                        'text-red-400': result.level === 'High'
                      }"
                      x-text="result.level"></span>
            </div>
            
            <div class="text-2xl font-bold mt-6"
                 :class="{
                    'text-green-400': result.level === 'Normal',
                    'text-blue-400': result.level === 'Low',
                    'text-yellow-400': result.level === 'Medium',
                    'text-red-400': result.level === 'High'
                 }"
                 x-text="result.level + ' Risk'">
            </div>
            
            <!-- Advice Text -->
            <p class="text-gray-400 text-center mt-4 h-12" x-text="result.advice"></p>

            <div class="w-full mt-8 text-center px-4 py-4 rounded-lg bg-gray-700 border border-gray-600">
                <span class="font-medium text-gray-300">Prediction updates in real-time.</span>
            </div>
        </div>
        
    </div>

</body>
</html>
